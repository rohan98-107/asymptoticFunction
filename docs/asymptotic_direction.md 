# Asymptotic Directions

This document describes how *asymptotic directions* are represented, normalized and used in the 'asymptoticFunction' package.
To recap an asymptotic direction is a vector which describes the **overall** direction "at infinity" of an unbounded sequence.
For a more formal definition see [mathematical_background.md](mathematical_background.md).

## Summary

An asymptotic direction, while typically normalized, can be thought of as a ray. In 'asymptoticFunction' we will often plot directions
as unit vectors for convenience. However in computation, we must be able to scale quickly. In order to keep the API as light as possible and allow for fast, numerically fault-tolerant scaling
we use 'NumPy' conventions for all directions/vectors. In particular we let a direction $d \in \mathbb{R}^n$ be represented by a one-dimension 'NumPy'
array of length $n$.

## Handling Infinity

### Sign-Preserving Infinity 

In asymptotic analysis the case of $d = \pm \infty$ must be handled with care. In particular consider the unbounded sequence in $\mathbb{R}^2$ given by $x_k = (k, k^2)$. Taking 
$$ \lim_{k \to \infty} \frac{x_k}{k} = (1, +\infty) $$
and so it may be the case that computing an asymptotic direction results in convergence in some components and divergence in others. For cases such as the above wherein there are finite components to the vector 
but there exists at least one component which is $+\infty$, we take this to mean $d = +\infty$. Similarly if at least one $-\infty$ appears in an otherwise finite vector we cast the entire vector $d = -\infty$. 
**We implement the vector $d = + \infty$ using 'NumPy's 'np.inf' and we implement the vector $d = -\infty$ using 'NumPy's '-np.inf'.** As an additional measure, the package defines a fixed constant INFTY which is, by default, set to math.inf. However, in higher dimensions for more computationally intensive 
operations it could be prudent to use a finite, but extremely large, floating point number. 

### Mixed Infinities 

Consider the unbounded sequence in $\mathbb{R}^2$ with $x_k = (k^2,-k^2)$. Taking 
$$ \lim_{k \to \infty} \frac{x_k}{k} = (+\infty, -\infty). $$
This scenario produces a direction which is geometrically and mathematically meaningless and therefore we map all values wherein np.inf AND -np.inf appear to 'NaN' (not a number) values. 

## Code Documentation 

### Normalization 

The normalization convention and infinity-handling are implemented by the function **asymptoticFunction.core.normalization.normalize_direction**, 
which enforces a canonical representation of directions before downstream use.
The function provides a single entry point for converting raw direction vectors into representations which are suitable for asymptotic computation.
The file *asymptoticFunction.core.normalization* is given below:
```python
from asymptoticFunction.core.config import INFTY, EPS
import numpy as np


def normalize_direction(d):
    d = np.asarray(d, dtype=float)

    if np.any(np.isnan(d)):
        return np.full_like(d, np.nan)

    has_pos_inf = np.any(np.isposinf(d))
    has_neg_inf = np.any(np.isneginf(d))

    if has_pos_inf and has_neg_inf:
        return np.full_like(d, np.nan)
    elif has_pos_inf:
        return np.full_like(d, +INFTY)
    elif has_neg_inf:
        return np.full_like(d, -INFTY)

    norm = np.linalg.norm(d)

    if norm < EPS:
        return d  # leave zero vector as is

    return d / norm
```

In practice users rarely construct infinite directions, they typically arise mid-computation or during approximation. 
An example of its usage is given below

```python
import numpy as np
from asymptoticFunction.core.normalization import normalize_direction

# downstream computation often requires vectorized input, we can use normalize_direction to ensure that we are passing...
# ...'safe' directions.
directions_raw = [
    np.array([1.0, 0.0]),
    np.array([1.0, np.inf]),
    np.array([0.0, 0.0]),
    np.array([np.inf, -np.inf]),
]

safe_dirs = [normalize_direction(d) for d in directions_raw] 

print(safe_dirs)
'''
Output: 
[
    array([1.0, 0.0]),     # finite normalized direction
    array([inf, inf]),     # pure infinite direction
    array([0.0, 0.0]),     # zero direction
    array([nan, nan])      # mixed infinity (invalid)
]
'''
```